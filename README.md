# 高级 Unreal Engine 4.26 对象引用调试器

一个专业级的UE4编辑器插件，用于深度分析对象引用关系，帮助开发者诊断内存泄漏和垃圾回收问题。

## 🎯 核心功能

### 📋 类实例查找
- **智能类选择器**：下拉选择UClass，支持搜索过滤和分类显示
- **常用类标记**：★标识常用类，优先显示
- **分类显示**：[Actor]、[Component]、[Widget]等颜色标识
- **快速搜索**：预设AActor、APawn、UActorComponent、UUserWidget按钮
- **精确过滤**：自动排除CDO、待销毁对象、原型对象
- **世界上下文**：支持编辑器世界、PIE世界、游戏世界的分别搜索

### 🌲 引用链可视化
- **树形结构**：清晰展示从目标对象到GC根的完整引用链
- **深度标识**：L0、L1、L2等层级标记，直观显示引用深度
- **颜色编码**：
  - 🟢 绿色：GC根对象
  - 🟡 黄色：直接引用
  - ⚪ 灰色：间接引用
- **防循环**：智能检测并处理循环引用

### 📊 统计分析面板
- **实时统计**：总实例数、引用者数、GC根对象数量
- **内存分析**：自动计算内存使用量（KB/MB单位转换）
- **性能监控**：搜索耗时、最大引用深度
- **分布分析**：类分布、世界分布统计

### 🔍 搜索历史
- **历史记录**：保存最近20次搜索记录
- **详细信息**：显示搜索时间、结果数量、耗时
- **快速恢复**：点击历史记录立即重新执行搜索

### 💾 数据导出
- **CSV格式**：表格化数据，便于Excel分析
- **JSON格式**：结构化数据，支持程序处理
- **完整统计**：导出包含详细统计信息
- **自动命名**：`类名_ObjectReferences_时间戳.csv/json`

## 🎨 用户界面

### 四栏专业布局
1. **实例列表**：显示找到的所有对象实例
2. **引用者详情**：显示选中对象的所有强引用者
3. **引用链树**：可视化引用链到GC根
4. **搜索历史**：历史搜索记录和快速访问

### 高级过滤选项
- ✅ 包含编辑器世界
- ✅ 包含PIE世界  
- ✅ 包含游戏世界
- ✅ 显示内存信息
- ✅ 显示引用链
- ✅ 显示统计信息
- ✅ 自动刷新

## 🛠️ 技术特性

### 核心引擎API集成
- **TObjectIterator**：高效遍历所有UObject实例
- **TActorIterator**：安全的Actor特化迭代器
- **IsReferenced API**：深度引用关系分析
- **FReferencerInformationList**：获取详细引用信息

### 性能优化
- **异步搜索**：后台线程执行，保持UI响应性
- **智能缓存**：缓存搜索结果，避免重复计算
- **按需分析**：只在选择对象时进行引用分析
- **内存友好**：使用共享指针管理大量数据

### Slate原生界面
- **响应式设计**：动态计数显示、实时统计更新
- **专业控件**：进度条、可折叠区域、网格布局
- **通知系统**：操作反馈和错误提示
- **工具提示**：详细的功能说明

## 📚 使用方法

### 1. 基本搜索
1. 点击"选择UClass"下拉菜单，选择要搜索的类（如`AActor`）
2. 系统自动开始搜索，或点击"搜索实例"按钮
3. 支持搜索框快速过滤类名
4. 在左侧实例列表中查看搜索结果

### 2. 引用分析
1. 在实例列表中选择一个对象
2. 中间面板显示所有引用该对象的其他对象
3. 右侧引用链树显示到GC根的完整路径

### 3. 问题诊断
- **内存泄漏**：查看对象的引用链，找出阻止GC的强引用
- **性能问题**：分析大量实例的分布和内存占用
- **架构理解**：通过引用关系了解系统结构

### 4. 数据导出
1. 执行搜索后点击"导出"按钮
2. 选择CSV或JSON格式
3. 数据包含完整的对象信息和统计数据

## 🔧 安装配置

### 系统要求
- Unreal Engine 4.26+
- Windows开发环境
- Visual Studio 2019+

### 安装步骤
1. 将插件文件夹复制到项目的`Plugins`目录
2. 重新生成项目文件
3. 编译项目
4. 在编辑器中启用插件：`Edit > Plugins > Developer Tools > ObjRefDebugger`

### 打开插件
- 菜单路径：`Window > 对象引用调试器`
- 快捷键：可在编辑器设置中自定义

## 🚀 高级使用技巧

### 1. 性能调优
- 使用过滤选项限制搜索范围
- 对于大型项目，优先搜索特定世界
- 利用缓存机制避免重复搜索

### 2. 内存调试工作流
1. 搜索疑似泄漏的类
2. 检查统计面板中"无引用者对象"数量
3. 分析引用链找出意外的强引用
4. 导出数据进行进一步分析

### 3. 架构分析
- 使用引用链了解对象生命周期管理
- 分析类分布优化内存布局
- 识别过度耦合的组件关系

## 📝 技术原理

### 垃圾回收机制
UE4采用标记-清除算法：
1. **根集**：从GC根对象开始
2. **标记**：递归标记所有可达对象
3. **清除**：销毁未标记的对象

### 强引用构成
- `UPROPERTY()`标记的UObject指针
- `UPROPERTY()`标记的引擎容器
- `FGCObject`接口实现
- `TStrongObjectPtr`智能指针

### 引用查找原理
通过`IsReferenced`API遍历引擎的内部引用图，获取完整的引用者信息，包括引用属性名称和引用类型。

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境搭建
1. Fork项目仓库
2. 创建功能分支
3. 遵循UE4编码规范
4. 提交前确保编译通过

### 代码结构
```
Source/ObjRefDebugger/
├── Public/
│   ├── ObjRefDebugger.h              # 模块主头文件
│   ├── ObjRefDebuggerTypes.h         # 数据结构定义
│   └── SObjRefDebuggerWindow.h       # 主窗口声明
├── Private/
│   ├── ObjRefDebugger.cpp            # 模块实现
│   ├── SObjRefDebuggerWindow.cpp     # UI构建（原始）
│   ├── SObjRefDebuggerWindowUI.cpp   # UI构建（增强）
│   ├── SObjRefDebuggerWindowLogic.cpp # 核心逻辑
│   └── SObjRefDebuggerWindowActions.cpp # 事件处理
└── ObjRefDebugger.Build.cs           # 构建配置
```

## 📄 许可证

本项目采用MIT许可证 - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- Epic Games：提供强大的Unreal Engine
- 社区贡献者：提供宝贵的反馈和建议
- 参考项目：ObjectBrowser、UBrowse等开源工具

---

**让内存调试变得简单直观！** 🎯 